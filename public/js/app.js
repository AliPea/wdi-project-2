"use strict";var Outdoorsy=Outdoorsy||{};Outdoorsy.api_url="http://localhost:3000/api",Outdoorsy.init=function(){this.apiUrl="http://localhost:3000/api",this.mapSetup(),this.eventListeners(),this.getToken()?this.loggedInState():this.loggedOutState()},Outdoorsy.eventListeners=function(){$(".modal form").on("submit",this.handleForm),$(".logout").on("click",this.logout.bind(this))},Outdoorsy.handleForm=function(){event.preventDefault();var t=""+Outdoorsy.apiUrl+$(this).attr("action"),e=$(this).attr("method"),o=$(this).serialize();return $($(this).parents(".modal")).modal("hide"),Outdoorsy.ajaxRequest(t,e,o,function(t){t.token&&Outdoorsy.setToken(t.token),Outdoorsy.loggedInState()})},Outdoorsy.ajaxRequest=function(t,e,o,i){return $.ajax({url:t,method:e,data:o,beforeSend:this.setRequestHeader.bind(this)}).done(i).fail(function(t){console.log(t)})},Outdoorsy.logout=function(){event.preventDefault(),this.removeToken(),this.loggedOutState()},Outdoorsy.setRequestHeader=function(t,e){return t.setRequestHeader("Authorization","Bearer "+this.getToken())},Outdoorsy.setToken=function(t){return window.localStorage.setItem("token",t)},Outdoorsy.getToken=function(){return window.localStorage.getItem("token")},Outdoorsy.removeToken=function(){return window.localStorage.clear()},Outdoorsy.loggedInState=function(){$(".loggedOut").hide(),$(".loggedIn").show()},Outdoorsy.loggedOutState=function(){$(".loggedOut").show(),$(".loggedIn").hide()},Outdoorsy.getCurrentLocation=function(){navigator.geolocation.getCurrentPosition(function(t){var e=new google.maps.Marker({position:new google.maps.LatLng(t.coords.latitude,t.coords.longitude),map:Outdoorsy.map,animation:google.maps.Animation.DROP,icon:{url:"http://furtaev.ru/preview/user_on_map_2_small.png",scaledSize:new google.maps.Size(56,56)}});Outdoorsy.map.setCenter(e.getPosition())})},Outdoorsy.addActivity=function(){event.preventDefault(),$.ajax({method:"POST",url:"http://localhost:3000/api/activities",data:$(this).serialize()}).done(function(t){console.log(t.activity),Outdoorsy.createMarkerForActivity(null,t.activity),$("form").reset().hide()})},Outdoorsy.mapSetup=function(){var t=document.getElementById("map-canvas");console.log(t);var e={zoom:13,center:new google.maps.LatLng(51.506178,(-.088369)),mapTypeId:google.maps.MapTypeId.ROADMAP,styles:[{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#444444"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:45}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#87b5db"},{visibility:"on"}]}]};this.map=new google.maps.Map(t,e),this.getActivities()},Outdoorsy.getActivities=function(){return $.get(this.api_url+"/activities").done(this.loopThroughActivities.bind(this))},Outdoorsy.loopThroughActivities=function(t){return $.each(t.activities,this.createMarkerForActivity.bind(this))},Outdoorsy.createMarkerForActivity=function(t,e){var o=new google.maps.LatLng(e.lat,e.lng),i={url:"/images/map-marker.png",scaledSize:new google.maps.Size(34.95,40),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,0)},n=new google.maps.Marker({position:o,map:this.map,icon:i});this.addInfoWindowForActivity(e,n)},Outdoorsy.addInfoWindowForActivity=function(t,e){var o=this;google.maps.event.addListener(e,"click",function(){"undefined"!=typeof o.infowindow&&o.infowindow.close(),o.infowindow=new google.maps.InfoWindow({content:'\n      <div class="info">\n      <img src="'+t.image+'">\n      <h3>'+t.name+"</h3>\n      <p>"+t.description+"</p>\n      </div>\n      "}),o.infowindow.open(o.map,e),o.map.setCenter(e.getPosition())})},$(Outdoorsy.init.bind(Outdoorsy));